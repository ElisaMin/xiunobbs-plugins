<div class="d-flex justify-content-between small mt-3">
    <div>
    </div>
    <div class="text-right"<?php echo $style_value;?>>
        <span class="date text-grey ml-2"><?php echo $_post['create_date_fmt'];?></span>
        <!--{hook post_list_inc_create_date_after.htm}-->

        <?php
        $shows = $_post['r_f_c']>0;
        $pid = $_post['pid'];
        if ($shows) {
            $n=0;
            $hiddentcontent='';
            $repeat_follows=json_decode($_post['repeat_follow'], true);
            $message_t=$deltag='';
            $is_hidden = false;
            //todo replace post req

            foreach($repeat_follows as $repeat_follow) {
                $del = $repeat_follow['uid']==$uid || $_post['floormanage'];
                $the_uid = $repeat_follow['uid'];
                // 这他妈一定是屎我日
                if ($is_hidden) { ?>

                <?php } ?>
                <dd class="text-left media" id="pf_<?= $pid.'_'.$repeat_follow['fl']?>">
                    <a href="<?= url("user-".$repeat_follow['uid']) ?>" class="mr-2">
                        <img class="avatar-3" src="<?= $repeat_follow['avatar_url']?>">
                    </a>
                    <div style="width:100%;">
                        <span class="text-left">
                            <a href="<?= url("user-".$repeat_follow['uid'])?>" class="text-muted font-weight-bold"><?= $repeat_follow['username']?></a>
                            :<?php if($repeat_follow['t_uid']>0 && $repeat_follow['t_username']!='') { ?>
                                回复 <a href="<?= url("user-".$repeat_follow['t_uid']) ?>" class="text-muted font-weight-bold"><?= $repeat_follow['t_username']?></a>:
                            <?php } echo $repeat_follow['message'] ?>
                        </span>
                        <div class="text-muted text-right">
                            <?php if ($repeat_follow['uid']==$uid || $_post['floormanage']) { ?>
                                <a href="javascript:delrfloor('<?=$pid.',\''.$repeat_follow['fl']?>\'');" class="post_update mr-2">删除</a>
                            <?php } echo humandate($repeat_follow['update']) ?>
                            <a href="javascript:showform('<?=$pid.',\''.$repeat_follow['username']?>\'');" class="post_update ml-2">回复</a>
                        </div>
                    </div>
                </dd>

                <?php
                if($n<$half_page)
                    echo '<dd class="text-left media" id="pf_'.$pid.'_'.$repeat_follow['fl'].'"><a href="'.url("user-".$repeat_follow['uid']).'" class="mr-2"><img class="avatar-3" onerror="this.src=\'view/img/avatar.png\'"  src="'.$repeat_follow['avatar_url'].'"></a><div style="width:100%;"><span class="text-left"><a href="'.url("user-".$repeat_follow['uid']).'" class="text-muted font-weight-bold">'.$repeat_follow['username'].'</a>: '.$message_t.$repeat_follow['message'].'</span><div class="text-muted text-right">'.$deltag.humandate($repeat_follow['update']).'<a href="javascript:showform('.$pid.',\''.$repeat_follow['username'].'\');" class="post_update ml-2">回复</a></div></div></dd>';
                elseif($n<$perPage)
                    $hiddentcontent.='<dd class="text-left media" id="pf_'.$pid.'_'.$repeat_follow['fl'].'"><a href="'.url("user-".$repeat_follow['uid']).'" class="mr-2"><img class="avatar-3" onerror="this.src=\'view/img/avatar.png\'"  src="'.$repeat_follow['avatar_url'].'"></a><div style="width:100%;"><span class="text-left"><a href="'.url("user-".$repeat_follow['uid']).'" class="text-muted font-weight-bold">'.$repeat_follow['username'].'</a>: '.$message_t.$repeat_follow['message'].'</span><div class="text-muted text-right">'.$deltag.humandate($repeat_follow['update']).'<a href="javascript:showform('.$pid.',\''.$repeat_follow['username'].'\');" class="post_update ml-2">回复</a></div></div></dd>';
                else
                    break;
                $message_t=$deltag='';
                $n++;
            } ?>
            <span style="display:none;font-size:1.1rem;" id="s_p<?= $pid?>">
                <a href="javascript:showpage(<?= $pid?>,1)"><i class="icon-angle-double-left"></i></a>
                <a class="ml-2 mr-2" href="javascript:showpage_p(<?= $pid?>)">
                    <i class="icon-angle-left"></i>
                </a>
            </span>
            <font class="font-weight-bold" id="np<?= $pid?>">1</font>
            /<?= $max_page?>
            <span id="e_p<?= $pid?>" style="font-size:1.1rem;">
                <a class="ml-2 mr-2" href="javascript:showpage_n(<?= $pid?>)">
                    <i class="icon-angle-right"></i>
                </a>
                <a href="javascript:showpage(<?= $pid.','.$max_page?>)">
                    <i class="icon-angle-double-right"></i>
                </a>
            </span>
            <input type="hidden" id="mp_<?= $pid.'" value="'.$max_page?>" />
            <input type="hidden" id="np_<?= $pid?>" value="1" />
        <?php } ?>
        <?php
        if($_post['r_f_c']>0){
            $max_page=ceil($_post['r_f_c']/$perPage);
            $page_list='';
            if($max_page>1) {
                $page_list='<span style="display:none;font-size:1.1rem;" id="s_p'.$pid.'"><a href="javascript:showpage('.$pid.',1)"><i class="icon-angle-double-left"></i></a><a class="ml-2 mr-2" href="javascript:showpage_p('.$pid.')"><i class="icon-angle-left"></i></a></span><font class="font-weight-bold" id="np'.$pid.'">1</font>/'.$max_page.'<span id="e_p'.$pid.'" style="font-size:1.1rem;"><a class="ml-2 mr-2" href="javascript:showpage_n('.$pid.')"><i class="icon-angle-right"></i></a><a href="javascript:showpage('.$pid.','.$max_page.')"><i class="icon-angle-double-right"></i></a></span><input type="hidden" id="mp_'.$pid.'" value="'.$max_page.'" /><input type="hidden" id="np_'.$pid.'" value="1" />';
            }
            echo '<a href="javascript:showrepeat('.$pid.');" class="ml-2 post_update floor win" id="floor_win'.$pid.'">收起回复</a>
									<div id="repeat_'.$pid.'">
										<div class="floor con">
											<input type="hidden" name="r_f_c" id="r_f_c_'.$pid.'" value="'.$_post['r_f_c'].'" />
											<dl style="margin-bottom:0.5rem;"><div id="floor_'.$pid.'">';
            $n=0;$hiddentcontent='';
            $repeat_follows=json_decode($_post['repeat_follow'], true);
            $message_t=$deltag='';
            foreach($repeat_follows as $repeat_follow){
                if($repeat_follow['uid']==$uid || $_post['floormanage']) $deltag='<a href="javascript:delrfloor('.$pid.',\''.$repeat_follow['fl'].'\');" class="post_update mr-2">删除</a>';
                if($repeat_follow['t_uid']>0 && $repeat_follow['t_username']!='') $message_t='回复 <a href="'.url("user-".$repeat_follow['t_uid']).'" class="text-muted font-weight-bold">'.$repeat_follow['t_username'].'</a>: ';
                if($n<$half_page) echo '<dd class="text-left media" id="pf_'.$pid.'_'.$repeat_follow['fl'].'"><a href="'.url("user-".$repeat_follow['uid']).'" class="mr-2"><img class="avatar-3" onerror="this.src=\'view/img/avatar.png\'"  src="'.$repeat_follow['avatar_url'].'"></a><div style="width:100%;"><span class="text-left"><a href="'.url("user-".$repeat_follow['uid']).'" class="text-muted font-weight-bold">'.$repeat_follow['username'].'</a>: '.$message_t.$repeat_follow['message'].'</span><div class="text-muted text-right">'.$deltag.humandate($repeat_follow['update']).'<a href="javascript:showform('.$pid.',\''.$repeat_follow['username'].'\');" class="post_update ml-2">回复</a></div></div></dd>';
                elseif($n<$perPage) $hiddentcontent.='<dd class="text-left media" id="pf_'.$pid.'_'.$repeat_follow['fl'].'"><a href="'.url("user-".$repeat_follow['uid']).'" class="mr-2"><img class="avatar-3" onerror="this.src=\'view/img/avatar.png\'"  src="'.$repeat_follow['avatar_url'].'"></a><div style="width:100%;"><span class="text-left"><a href="'.url("user-".$repeat_follow['uid']).'" class="text-muted font-weight-bold">'.$repeat_follow['username'].'</a>: '.$message_t.$repeat_follow['message'].'</span><div class="text-muted text-right">'.$deltag.humandate($repeat_follow['update']).'<a href="javascript:showform('.$pid.',\''.$repeat_follow['username'].'\');" class="post_update ml-2">回复</a></div></div></dd>';
                else break;
                $message_t=$deltag='';
                $n++;
            }
            echo '<div id="pushfloor_'.$pid.'" style="display:none;">'.$hiddentcontent.'</div></div>
												<div id="pushfloor'.$pid.'" class="justify-content-between d-flex">
													<div id="floor_note'.$pid.'" class="text-left">';if($_post['r_f_c']>$half_page){echo '还有'.($_post['r_f_c']-$half_page).'条回复，<a href="javascript:showfloor('.$pid.')">查看</a>';}echo '</div><div id="floor_page'.$pid.'" style="display:none;">'.$page_list.'</div>
													<div class="text-right"><button type="submit" class="btn btn-sm btn-secondary" onclick="javascript:showform('.$pid.');" id="submit"> 我说一句 </button></div>
												</div>
											</dl>
											<div id="repeatform'.$pid.'" class="mb-2"></div>
										</div>
									</div>';
        }
        else{
            ?>
            <a href="javascript:showrepeat(<?php echo $pid;?>);" class="ml-2 post_update" id="floor_win<?php echo $pid;?>"><i class="icon-comment-o"></i> 回复</a>
            <div style="display:none;" id="repeat_<?php echo $pid;?>">
                <div class="floor con">
                    <input type="hidden" name="r_f_c" id="r_f_c_<?php echo $pid;?>" value="0" />
                    <dl class="text-white" style="margin-bottom:0.5rem;">
                        <div id="pushfloor_<?php echo $pid;?>"></div>
                    </dl>
                    <div id="repeatform<?php echo $pid;?>" class="mb-2">
                    </div>
                </div>
            </div>
        <?php } ?>
    </div>
</div>